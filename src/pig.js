// Generated by CoffeeScript 1.3.1
(function() {
  var Config, ConnectionManager, Pig, logger, net;

  net = require('net');

  Config = require('../config');

  logger = require('./logger');

  ConnectionManager = require('./connectionManager');

  Pig = (function() {

    Pig.name = 'Pig';

    function Pig() {
      this.cm = new ConnectionManager();
    }

    Pig.prototype.run = function() {
      var self, server;
      self = this;
      server = net.createServer(function(stream) {
        stream.setEncoding("utf8");
        stream.on('connect', function(socketFd) {
          logger.log('connect');
          return stream.write("accepted\r\n");
        });
        stream.on('data', function(data) {
          return self.onDataHandler(data);
        });
        return stream.on('end', function() {
          logger.log('end');
          return stream.end;
        });
      });
      server.on('connection', function(socket) {
        logger.log("connection");
        self.cm.add(socket);
        return logger.log(self.cm.size());
      });
      server.listen(Config.port, Config.host);
      return logger.log("server running on port " + Config.port);
    };

    Pig.prototype.onDataHandler = function(data) {
      return logger.log(data);
    };

    return Pig;

  })();

  module.exports = Pig;

}).call(this);
